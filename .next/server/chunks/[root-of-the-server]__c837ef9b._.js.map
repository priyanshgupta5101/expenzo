{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 97, "column": 0}, "map": {"version":3,"sources":["file:///D:/Expenzo/lib/inngest/client.js"],"sourcesContent":["import { Inngest } from \"inngest\";\r\nimport { Resend } from \"resend\";\r\n\r\n// Initialize the Inngest client\r\nexport const inngest = new Inngest({\r\n  id: \"expenzo\",\r\n  name: \"expenzo\",\r\n});\r\n\r\nexport const resend = new Resend(process.env.RESEND_API_KEY);\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAGO,MAAM,UAAU,IAAI,6IAAO,CAAC;IACjC,IAAI;IACJ,MAAM;AACR;AAEO,MAAM,SAAS,IAAI,oJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc","debugId":null}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///D:/Expenzo/convex/_generated/api.js"],"sourcesContent":["/* eslint-disable */\r\n/**\r\n * Generated `api` utility.\r\n *\r\n * THIS CODE IS AUTOMATICALLY GENERATED.\r\n *\r\n * To regenerate, run `npx convex dev`.\r\n * @module\r\n */\r\n\r\nimport { anyApi } from \"convex/server\";\r\n\r\n/**\r\n * A utility for referencing Convex functions in your app's API.\r\n *\r\n * Usage:\r\n * ```js\r\n * const myFunctionReference = api.myModule.myFunction;\r\n * ```\r\n */\r\nexport const api = anyApi;\r\nexport const internal = anyApi;\r\n"],"names":[],"mappings":"AAAA,kBAAkB,GAClB;;;;;;;CAOC;;;;;;AAED;AAAA;;AAUO,MAAM,MAAM,kKAAM;AAClB,MAAM,WAAW,kKAAM","debugId":null}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///D:/Expenzo/lib/inngest/payment-reminders.js"],"sourcesContent":["import { ConvexHttpClient } from \"convex/browser\";\r\nimport { api } from \"@/convex/_generated/api\";\r\nimport { inngest } from \"./client\";\r\n\r\n// Initialize Convex client\r\nconst convex = new ConvexHttpClient(process.env.NEXT_PUBLIC_CONVEX_URL);\r\n\r\nexport const paymentReminders = inngest.createFunction(\r\n  { id: \"send-payment-reminders\" },\r\n  { cron: \"0 10 * * *\" }, // daily at 10 AM UTC\r\n  async ({ step }) => {\r\n    /* 1. fetch all users that still owe money */\r\n    const users = await step.run(\"fetch‑debts\", () =>\r\n      convex.query(api.inngest.getUsersWithOutstandingDebts)\r\n    );\r\n\r\n    /* 2. build & send one e‑mail per user */\r\n    const results = await step.run(\"send‑emails\", async () => {\r\n      return Promise.all(\r\n        users.map(async (u) => {\r\n          const rows = u.debts\r\n            .map(\r\n              (d) => `\r\n                <tr>\r\n                  <td style=\"padding:4px 8px;\">${d.name}</td>\r\n                  <td style=\"padding:4px 8px;\">$${d.amount.toFixed(2)}</td>\r\n                </tr>\r\n              `\r\n            )\r\n            .join(\"\");\r\n\r\n          if (!rows) return { userId: u._id, skipped: true };\r\n\r\n          const html = `\r\n            <h2>Expenzo – Payment Reminder</h2>\r\n            <p>Hi ${u.name}, you have the following outstanding balances:</p>\r\n            <table cellspacing=\"0\" cellpadding=\"0\" border=\"1\" style=\"border-collapse:collapse;\">\r\n              <thead>\r\n                <tr><th>To</th><th>Amount</th></tr>\r\n              </thead>\r\n              <tbody>${rows}</tbody>\r\n            </table>\r\n            <p>Please settle up soon. Thanks!</p>\r\n          `;\r\n\r\n          try {\r\n            await convex.action(api.email.sendEmail, {\r\n              to: u.email,\r\n              subject: \"You have pending payments on Expenzo\",\r\n              html,\r\n              apiKey: process.env.RESEND_API_KEY,\r\n            });\r\n            return { userId: u._id, success: true };\r\n          } catch (err) {\r\n            return { userId: u._id, success: false, error: err.message };\r\n          }\r\n        })\r\n      );\r\n    });\r\n\r\n    return {\r\n      processed: results.length,\r\n      successes: results.filter((r) => r.success).length,\r\n      failures: results.filter((r) => r.success === false).length,\r\n    };\r\n  }\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;;;;AAEA,2BAA2B;AAC3B,MAAM,SAAS,IAAI,qLAAgB;AAE5B,MAAM,mBAAmB,qIAAO,CAAC,cAAc,CACpD;IAAE,IAAI;AAAyB,GAC/B;IAAE,MAAM;AAAa,GACrB,OAAO,EAAE,IAAI,EAAE;IACb,2CAA2C,GAC3C,MAAM,QAAQ,MAAM,KAAK,GAAG,CAAC,eAAe,IAC1C,OAAO,KAAK,CAAC,oIAAG,CAAC,OAAO,CAAC,4BAA4B;IAGvD,uCAAuC,GACvC,MAAM,UAAU,MAAM,KAAK,GAAG,CAAC,eAAe;QAC5C,OAAO,QAAQ,GAAG,CAChB,MAAM,GAAG,CAAC,OAAO;YACf,MAAM,OAAO,EAAE,KAAK,CACjB,GAAG,CACF,CAAC,IAAM,CAAC;;+CAEyB,EAAE,EAAE,IAAI,CAAC;gDACR,EAAE,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG;;cAExD,CAAC,EAEF,IAAI,CAAC;YAER,IAAI,CAAC,MAAM,OAAO;gBAAE,QAAQ,EAAE,GAAG;gBAAE,SAAS;YAAK;YAEjD,MAAM,OAAO,CAAC;;kBAEN,EAAE,EAAE,IAAI,CAAC;;;;;qBAKN,EAAE,KAAK;;;UAGlB,CAAC;YAED,IAAI;gBACF,MAAM,OAAO,MAAM,CAAC,oIAAG,CAAC,KAAK,CAAC,SAAS,EAAE;oBACvC,IAAI,EAAE,KAAK;oBACX,SAAS;oBACT;oBACA,QAAQ,QAAQ,GAAG,CAAC,cAAc;gBACpC;gBACA,OAAO;oBAAE,QAAQ,EAAE,GAAG;oBAAE,SAAS;gBAAK;YACxC,EAAE,OAAO,KAAK;gBACZ,OAAO;oBAAE,QAAQ,EAAE,GAAG;oBAAE,SAAS;oBAAO,OAAO,IAAI,OAAO;gBAAC;YAC7D;QACF;IAEJ;IAEA,OAAO;QACL,WAAW,QAAQ,MAAM;QACzB,WAAW,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO,EAAE,MAAM;QAClD,UAAU,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO,KAAK,OAAO,MAAM;IAC7D;AACF","debugId":null}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///D:/Expenzo/lib/inngest/spending-insights.js"],"sourcesContent":["import { ConvexHttpClient } from \"convex/browser\";\r\nimport { api } from \"@/convex/_generated/api\";\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\nimport { inngest } from \"./client\";\r\n\r\nconst convex = new ConvexHttpClient(process.env.NEXT_PUBLIC_CONVEX_URL);\r\n\r\n/* Gemini model (same as before) */\r\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\r\nconst model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n\r\nexport const spendingInsights = inngest.createFunction(\r\n  { name: \"Generate Spending Insights\", id: \"generate-spending-insights\" },\r\n  { cron: \"0 8 1 * *\" }, // 1 st of every month at 08:00\r\n  async ({ step }) => {\r\n    /* ─── 1. Pull users with expenses this month ────────────────────── */\r\n    const users = await step.run(\"Fetch users with expenses\", async () => {\r\n      return await convex.query(api.inngest.getUsersWithExpenses);\r\n    });\r\n\r\n    /* ─── 2. Iterate users & send insight email ─────────────────────── */\r\n    const results = [];\r\n\r\n    for (const user of users) {\r\n      /* a. Pull last-month expenses (skip if none) */\r\n      const expenses = await step.run(`Expenses · ${user._id}`, () =>\r\n        convex.query(api.inngest.getUserMonthlyExpenses, { userId: user._id })\r\n      );\r\n      if (!expenses?.length) continue;\r\n\r\n      /* b. Build JSON blob for the prompt */\r\n      const expenseData = JSON.stringify({\r\n        expenses,\r\n        totalSpent: expenses.reduce((sum, e) => sum + e.amount, 0),\r\n        categories: expenses.reduce((cats, e) => {\r\n          cats[e.category ?? \"uncategorised\"] =\r\n            (cats[e.category] ?? 0) + e.amount;\r\n          return cats;\r\n        }, {}),\r\n      });\r\n\r\n      /* c. Prompt + AI call using step.ai.wrap (retry-aware) */\r\n      const prompt = `\r\nAs a financial analyst, review this user's spending data for the past month and provide insightful observations and suggestions.\r\nFocus on spending patterns, category breakdowns, and actionable advice for better financial management.\r\nUse a friendly, encouraging tone. Format your response in HTML for an email.\r\n\r\nUser spending data:\r\n${expenseData}\r\n\r\nProvide your analysis in these sections:\r\n1. Monthly Overview\r\n2. Top Spending Categories\r\n3. Unusual Spending Patterns (if any)\r\n4. Saving Opportunities\r\n5. Recommendations for Next Month\r\n      `.trim();\r\n\r\n      try {\r\n        const aiResponse = await step.ai.wrap(\r\n          \"gemini\",\r\n          async (p) => model.generateContent(p),\r\n          prompt\r\n        );\r\n\r\n        const htmlBody =\r\n          aiResponse.response.candidates[0]?.content.parts[0]?.text ?? \"\";\r\n\r\n        /* d. Send the email */\r\n        await step.run(`Email · ${user._id}`, () =>\r\n          convex.action(api.email.sendEmail, {\r\n            to: user.email,\r\n            subject: \"Your Monthly Spending Insights\",\r\n            html: `\r\n              <h1>Your Monthly Financial Insights</h1>\r\n              <p>Hi ${user.name},</p>\r\n              <p>Here's your personalized spending analysis for the past month:</p>\r\n              ${htmlBody}\r\n            `,\r\n            apiKey: process.env.RESEND_API_KEY,\r\n          })\r\n        );\r\n\r\n        results.push({ userId: user._id, success: true });\r\n      } catch (err) {\r\n        results.push({\r\n          userId: user._id,\r\n          success: false,\r\n          error: err.message,\r\n        });\r\n      }\r\n    }\r\n\r\n    /* ─── 3. Summary for the cron log ───────────────────────────────── */\r\n    return {\r\n      processed: results.length,\r\n      success: results.filter((r) => r.success).length,\r\n      failed: results.filter((r) => !r.success).length,\r\n    };\r\n  }\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;;;;AAEA;;;;;AAEA,MAAM,SAAS,IAAI,qLAAgB;AAEnC,iCAAiC,GACjC,MAAM,QAAQ,IAAI,mBAAmB,QAAQ,GAAG,CAAC,cAAc;AAC/D,MAAM,QAAQ,MAAM,kBAAkB,CAAC;IAAE,OAAO;AAAmB;AAE5D,MAAM,mBAAmB,qIAAO,CAAC,cAAc,CACpD;IAAE,MAAM;IAA8B,IAAI;AAA6B,GACvE;IAAE,MAAM;AAAY,GACpB,OAAO,EAAE,IAAI,EAAE;IACb,qEAAqE,GACrE,MAAM,QAAQ,MAAM,KAAK,GAAG,CAAC,6BAA6B;QACxD,OAAO,MAAM,OAAO,KAAK,CAAC,oIAAG,CAAC,OAAO,CAAC,oBAAoB;IAC5D;IAEA,qEAAqE,GACrE,MAAM,UAAU,EAAE;IAElB,KAAK,MAAM,QAAQ,MAAO;QACxB,8CAA8C,GAC9C,MAAM,WAAW,MAAM,KAAK,GAAG,CAAC,CAAC,WAAW,EAAE,KAAK,GAAG,EAAE,EAAE,IACxD,OAAO,KAAK,CAAC,oIAAG,CAAC,OAAO,CAAC,sBAAsB,EAAE;gBAAE,QAAQ,KAAK,GAAG;YAAC;QAEtE,IAAI,CAAC,UAAU,QAAQ;QAEvB,qCAAqC,GACrC,MAAM,cAAc,KAAK,SAAS,CAAC;YACjC;YACA,YAAY,SAAS,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM,EAAE;YACxD,YAAY,SAAS,MAAM,CAAC,CAAC,MAAM;gBACjC,IAAI,CAAC,EAAE,QAAQ,IAAI,gBAAgB,GACjC,CAAC,IAAI,CAAC,EAAE,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM;gBACpC,OAAO;YACT,GAAG,CAAC;QACN;QAEA,wDAAwD,GACxD,MAAM,SAAS,CAAC;;;;;;AAMtB,EAAE,YAAY;;;;;;;;MAQR,CAAC,CAAC,IAAI;QAEN,IAAI;YACF,MAAM,aAAa,MAAM,KAAK,EAAE,CAAC,IAAI,CACnC,UACA,OAAO,IAAM,MAAM,eAAe,CAAC,IACnC;YAGF,MAAM,WACJ,WAAW,QAAQ,CAAC,UAAU,CAAC,EAAE,EAAE,QAAQ,KAAK,CAAC,EAAE,EAAE,QAAQ;YAE/D,qBAAqB,GACrB,MAAM,KAAK,GAAG,CAAC,CAAC,QAAQ,EAAE,KAAK,GAAG,EAAE,EAAE,IACpC,OAAO,MAAM,CAAC,oIAAG,CAAC,KAAK,CAAC,SAAS,EAAE;oBACjC,IAAI,KAAK,KAAK;oBACd,SAAS;oBACT,MAAM,CAAC;;oBAEC,EAAE,KAAK,IAAI,CAAC;;cAElB,EAAE,SAAS;YACb,CAAC;oBACD,QAAQ,QAAQ,GAAG,CAAC,cAAc;gBACpC;YAGF,QAAQ,IAAI,CAAC;gBAAE,QAAQ,KAAK,GAAG;gBAAE,SAAS;YAAK;QACjD,EAAE,OAAO,KAAK;YACZ,QAAQ,IAAI,CAAC;gBACX,QAAQ,KAAK,GAAG;gBAChB,SAAS;gBACT,OAAO,IAAI,OAAO;YACpB;QACF;IACF;IAEA,qEAAqE,GACrE,OAAO;QACL,WAAW,QAAQ,MAAM;QACzB,SAAS,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,OAAO,EAAE,MAAM;QAChD,QAAQ,QAAQ,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,OAAO,EAAE,MAAM;IAClD;AACF","debugId":null}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///D:/Expenzo/app/api/inngest/route.js"],"sourcesContent":["import { serve } from \"inngest/next\";\r\nimport { inngest } from \"@/lib/inngest/client\";\r\nimport { paymentReminders } from \"@/lib/inngest/payment-reminders\";\r\nimport { spendingInsights } from \"@/lib/inngest/spending-insights\";\r\n\r\n// Create an API that serves zero functions\r\nexport const { GET, POST, PUT } = serve({\r\n  client: inngest,\r\n  functions: [\r\n    /* your functions will be passed here later! */\r\n    spendingInsights,\r\n    paymentReminders,\r\n  ],\r\n});\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAGO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,IAAA,0IAAK,EAAC;IACtC,QAAQ,qIAAO;IACf,WAAW;QACT,6CAA6C,GAC7C,4JAAgB;QAChB,4JAAgB;KACjB;AACH","debugId":null}}]
}